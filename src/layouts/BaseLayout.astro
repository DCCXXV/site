---
import Sidebar from "../components/Sidebar.astro";
import Layout from "../layouts/Layout.astro";
import 'glightbox/dist/css/glightbox.min.css';

interface Props {
    title: string;
    pageHeader: string;
    lang?: string;
}

const { title, pageHeader, lang = "en" } = Astro.props;
---

<Layout title={title} lang={lang}>
    <main>
        <section id="text">
            <h1 class="cardo-bold">{pageHeader}</h1>
            <slot />
        </section>
        <Sidebar />
    </main>
</Layout>

<style>
    main {
        display: flex;
    }
    h1 {
        text-decoration: underline;
        margin-bottom: 0.5rem;
    }

    #text {
        margin: 1.5rem;
        width: 60%;
        padding-right: 1.5rem;
        border-right: 2px dashed var(--sol-dark);
    }

    #text :global(h2) {
        margin-bottom: 0.25rem;
        margin-top: 1rem;
    }

    #text :global(p) {
        margin-bottom: 0.5rem;
        font-variant-emoji: text;

        text-align: justify;
        hyphens: auto;
        text-justify: inter-word;
    }

    #text :global(a) {
        color: var(--sol-blue);
    }

    #text :global(a:visited) {
        color: var(--sol-dark);
    }

    #text :global(ul) {
        margin-left: 2rem;
        list-style-type: square;
    }

    #text :global(blockquote) {
        font-style: italic;
    }

    #text :global(img) {
        max-width: 100%;
        border: 1px solid var(--sol-dark);
    }

    #text :global(.img-file) {
        background-color: var(--sol-pink);
        border: 4px double var(--sol-dark);
        width: fit-content;
        padding: 0.15rem 1rem;
        margin: 1rem 0 4px 0;
    }

    #text :global(.img-frame) {
        background-color: var(--sol-metal);
        border: 1px solid var(--sol-dark);
        color: var(--sol-dark);
        padding: 0.5rem;
    }

    #text :global(.tabbed-images) {
        margin: 1rem 0;
    }

    #text :global(.tabs) {
        display: flex;
        gap: 4px;
        margin-bottom: 4px;
        flex-wrap: wrap;
    }

    #text :global(.tab) {
        background-color: var(--sol-pink);
        border: 4px double var(--sol-dark);
        padding: 0.15rem 1rem;
        cursor: pointer;
        font-family: inherit;
        font-size: inherit;
        color: var(--sol-dark);
        transition: opacity 0.2s;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    #text :global(.tab.active) {
        opacity: 1;
        font-weight: bold;
    }

    #text :global(.tab:not(.active)) {
        background-color: var(--sol-metal);
    }

    #text :global(.tab-filename) {
        display: inline;
    }

    #text :global(.tab-panel) {
        display: none;
    }

    #text :global(.tab-panel.active) {
        display: block;
    }

    #text :global(.glightbox) {
        cursor: pointer;
        display: block;
    }

    #text :global(.glightbox img) {
        transition: opacity 0.2s;
    }

    #text :global(.glightbox:hover img) {
        opacity: 0.9;
    }

    @media (max-width: 768px) {
        main {
            flex-direction: column;
            overflow-x: hidden;
        }

        #text {
            width: 100%;
            margin: 0;
            padding: 1rem;
            border-right: none;
            border-bottom: 2px dashed var(--sol-dark);
            box-sizing: border-box;
        }
    }
</style>

<script>
    import GLightbox from 'glightbox';

    document.addEventListener('astro:page-load', () => {
        const tabbedContainers = document.querySelectorAll('.tabbed-images');

        tabbedContainers.forEach(container => {
            const tabs = container.querySelectorAll('.tab');
            const panels = container.querySelectorAll('.tab-panel');

            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const index = tab.getAttribute('data-index');

                    container.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    container.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));

                    tab.classList.add('active');
                    const panel = container.querySelector(`[data-panel="${index}"]`);
                    if (panel) {
                        panel.classList.add('active');
                    }
                });
            });
        });

        const lightbox = GLightbox({
            selector: '.glightbox',
            touchNavigation: true,
            loop: false,
            autoplayVideos: false
        });
    });
</script>
